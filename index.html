<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snow Ice Business Manager</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1><i class="fas fa-snowflake"></i> J&J Trini Island Treats Manager</h1>
            <nav class="nav-tabs">
                <button class="tab-btn active" data-tab="dashboard">
                    <i class="fas fa-chart-line"></i> Dashboard
                </button>
                <button class="tab-btn" data-tab="sales">
                    <i class="fas fa-dollar-sign"></i> Sales
                </button>
                <button class="tab-btn" data-tab="expenses">
                    <i class="fas fa-receipt"></i> Expenses
                </button>
                <button class="tab-btn" data-tab="inventory">
                    <i class="fas fa-boxes"></i> Inventory
                </button>
            </nav>
        </header>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="section-header" style="margin-bottom: 15px;">
                <h2 style="margin:0; color:#4a5568;"><i class="fas fa-calendar"></i> Dashboard</h2>
                <div style="display:flex; gap:8px; align-items:center;">
                    <button class="btn btn-secondary" onclick="businessManager.changeDashboardMonth(-1)"><i class="fas fa-chevron-left"></i></button>
                    <input type="month" id="dashboardMonthPicker" />
                    <button class="btn btn-secondary" onclick="businessManager.changeDashboardMonth(1)"><i class="fas fa-chevron-right"></i></button>
                </div>
            </div>
            <div class="dashboard-grid">
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-dollar-sign"></i> Total Sales</h3>
                    </div>
                    <div class="card-value" id="totalSales">$0.00</div>
                    <div class="card-subtitle">This Month</div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-receipt"></i> Total Expenses</h3>
                    </div>
                    <div class="card-value" id="totalExpenses">$0.00</div>
                    <div class="card-subtitle">This Month</div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-chart-line"></i> Net Profit</h3>
                    </div>
                    <div class="card-value" id="netProfit">$0.00</div>
                    <div class="card-subtitle">This Month</div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-university"></i> Bank Balance</h3>
                    </div>
                    <div class="card-value" id="bankBalance">$0.00</div>
                    <div class="card-subtitle">Current Balance</div>
                </div>
            </div>

            <div class="recent-activity">
                <h3>Recent Activity</h3>
                <div id="recentActivity" class="activity-list">
                    <p class="no-data">No recent activity</p>
                </div>
            </div>

            <!-- Backup & Restore -->
            <div class="section-header" style="margin-top: 25px;">
                <h2><i class="fas fa-database"></i> Backup & Restore</h2>
                <div>
                    <button class="btn btn-secondary" onclick="exportAllJSON()">
                        <i class="fas fa-file-export"></i> Export All (JSON)
                    </button>
                    <button class="btn btn-secondary" onclick="document.getElementById('importAllJsonInput').click()">
                        <i class="fas fa-file-import"></i> Import All (JSON)
                    </button>
                    <input type="file" id="importAllJsonInput" accept="application/json,.json" style="display:none" />
                </div>
            </div>
        </div>

        <!-- Sales Tab -->
        <div id="sales" class="tab-content">
            <div class="section-header">
                <h2><i class="fas fa-dollar-sign"></i> Sales Management</h2>
                <button class="btn btn-primary" onclick="openModal('salesModal')">
                    <i class="fas fa-plus"></i> Add Sale
                </button>
                <div>
                    <button class="btn btn-secondary" onclick="exportCSV('sales')">
                        <i class="fas fa-file-csv"></i> Export CSV
                    </button>
                    <button class="btn btn-secondary" onclick="document.getElementById('importSalesCsvInput').click()">
                        <i class="fas fa-file-import"></i> Import CSV
                    </button>
                    <input type="file" id="importSalesCsvInput" accept=".csv,text/csv" style="display:none" />
                </div>
            </div>
            
            <div class="filters">
                <input type="date" id="salesDateFilter" placeholder="Filter by date">
                <input type="text" id="salesSearch" placeholder="Search sales...">
            </div>
            
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Item</th>
                            <th>Quantity</th>
                            <th>Price</th>
                            <th>Total</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="salesTableBody">
                        <tr class="no-data-row">
                            <td colspan="6">No sales recorded yet</td>
                        </tr>
                    </tbody>
                </table>
                <div id="salesPagination" style="display:flex; gap:8px; justify-content:flex-end; padding:10px;"></div>
            </div>
        </div>

        <!-- Expenses Tab -->
        <div id="expenses" class="tab-content">
            <div class="section-header">
                <h2><i class="fas fa-receipt"></i> Expense Management</h2>
                <button class="btn btn-primary" onclick="openModal('expensesModal')">
                    <i class="fas fa-plus"></i> Add Expense
                </button>
                <div>
                    <button class="btn btn-secondary" onclick="exportCSV('expenses')">
                        <i class="fas fa-file-csv"></i> Export CSV
                    </button>
                    <button class="btn btn-secondary" onclick="document.getElementById('importExpensesCsvInput').click()">
                        <i class="fas fa-file-import"></i> Import CSV
                    </button>
                    <input type="file" id="importExpensesCsvInput" accept=".csv,text/csv" style="display:none" />
                </div>
            </div>
            
            <div class="filters">
                <select id="expenseCategoryFilter">
                    <option value="">All Categories</option>
                    <option value="ingredients">Ingredients</option>
                    <option value="equipment">Equipment</option>
                    <option value="labels">Labels</option>
                    <option value="tithes">Tithes</option>
                    <option value="rent">Rent</option>
                    <option value="marketing">Marketing</option>
                    <option value="other">Other</option>
                </select>
                <input type="date" id="expensesDateFilter" placeholder="Filter by date">
                <input type="text" id="expensesSearch" placeholder="Search expenses...">
            </div>
            
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Category</th>
                            <th>Store/Vendor</th>
                            <th>Description</th>
                            <th>Amount</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="expensesTableBody">
                        <tr class="no-data-row">
                            <td colspan="6">No expenses recorded yet</td>
                        </tr>
                    </tbody>
                </table>
                <div id="expensesPagination" style="display:flex; gap:8px; justify-content:flex-end; padding:10px;"></div>
            </div>
        </div>

        <!-- Inventory Tab -->
        <div id="inventory" class="tab-content">
            <div class="section-header">
                <h2><i class="fas fa-boxes"></i> Inventory Management</h2>
                <button class="btn btn-primary" onclick="openModal('inventoryModal')">
                    <i class="fas fa-plus"></i> Add Item
                </button>
                <div>
                    <button class="btn btn-secondary" onclick="exportCSV('inventory')">
                        <i class="fas fa-file-csv"></i> Export CSV
                    </button>
                    <button class="btn btn-secondary" onclick="document.getElementById('importInventoryCsvInput').click()">
                        <i class="fas fa-file-import"></i> Import CSV
                    </button>
                    <input type="file" id="importInventoryCsvInput" accept=".csv,text/csv" style="display:none" />
                </div>
            </div>
            
            <div class="filters">
                <select id="inventoryCategoryFilter">
                    <option value="">All Categories</option>
                    <option value="syrups">Syrups</option>
                    <option value="toppings">Toppings</option>
                    <option value="cups">Cups & Containers</option>
                    <option value="equipment">Equipment</option>
                    <option value="other">Other</option>
                </select>
                <input type="text" id="inventorySearch" placeholder="Search inventory...">
            </div>
            
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Item Name</th>
                            <th>Category</th>
                            <th>Current Stock</th>
                            <th>Min Stock</th>
                            <th>Unit Cost</th>
                            <th>Total Value</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="inventoryTableBody">
                        <tr class="no-data-row">
                            <td colspan="7">No inventory items yet</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Sales Modal -->
    <div id="salesModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Sale</h3>
                <span class="close" onclick="closeModal('salesModal')">&times;</span>
            </div>
            <form id="salesForm">
                <div class="form-group">
                    <label for="saleDate">Date:</label>
                    <input type="date" id="saleDate" required>
                </div>
                <div class="form-group">
                    <label for="saleItem">Item:</label>
                    <input type="text" id="saleItem" placeholder="e.g., Snow Ice Cup" required>
                </div>
                <div class="form-group">
                    <label for="saleInventoryItem">Update Inventory (Optional):</label>
                    <select id="saleInventoryItem">
                        <option value="">No inventory update</option>
                    </select>
                    <small class="form-help">Select an inventory item to automatically reduce stock when this sale is recorded</small>
                    <div id="inventorySummary" class="inventory-summary" style="margin-top: 10px; padding: 10px; background: #f7fafc; border-radius: 6px; font-size: 12px; color: #4a5568;">
                        <!-- Dynamic inventory summary will be populated here -->
                    </div>
                </div>
                <div class="form-group">
                    <label for="saleQuantity">Quantity:</label>
                    <input type="number" id="saleQuantity" min="1" required>
                </div>
                <div class="form-group">
                    <label for="salePrice">Price per Unit:</label>
                    <input type="number" id="salePrice" step="0.01" min="0" required>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('salesModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Sale</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Expenses Modal -->
    <div id="expensesModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Expense</h3>
                <span class="close" onclick="closeModal('expensesModal')">&times;</span>
            </div>
            <form id="expensesForm">
                <div class="form-group">
                    <label for="expenseDate">Date:</label>
                    <input type="date" id="expenseDate" required>
                </div>
                <div class="form-group">
                    <label for="expenseCategory">Category:</label>
                    <select id="expenseCategory" required>
                        <option value="">Select Category</option>
                        <option value="ingredients">Ingredients</option>
                        <option value="equipment">Equipment</option>
                        <option value="labels">Labels</option>
                        <option value="tithes">Tithes</option>
                        <option value="rent">Rent</option>
                        <option value="marketing">Marketing</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="expenseStoreVendor">Store/Vendor:</label>
                    <input type="text" id="expenseStoreVendor" placeholder="e.g., Pricesmart, Massy" required>
                </div>
                <div class="form-group">
                    <label for="expenseDescription">Description:</label>
                    <input type="text" id="expenseDescription" placeholder="e.g., Sugar, Ice, Cups" required>
                </div>
                <div class="form-group">
                    <label for="expenseAmount">Amount:</label>
                    <input type="number" id="expenseAmount" step="0.01" min="0" required>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('expensesModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Expense</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Inventory Modal -->
    <div id="inventoryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Inventory Item</h3>
                <span class="close" onclick="closeModal('inventoryModal')">&times;</span>
            </div>
            <form id="inventoryForm">
                <div class="form-group">
                    <label for="inventoryName">Item Name:</label>
                    <input type="text" id="inventoryName" placeholder="e.g., Strawberry Syrup" required>
                </div>
                <div class="form-group">
                    <label for="inventoryCategory">Category:</label>
                    <select id="inventoryCategory" required>
                        <option value="">Select Category</option>
                        <option value="syrups">Syrups</option>
                        <option value="toppings">Toppings</option>
                        <option value="cups">Cups & Containers</option>
                        <option value="equipment">Equipment</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="inventoryStock">Current Stock:</label>
                    <input type="number" id="inventoryStock" min="0" required>
                </div>
                <div class="form-group">
                    <label for="inventoryMinStock">Minimum Stock:</label>
                    <input type="number" id="inventoryMinStock" min="0" required>
                </div>
                <div class="form-group">
                    <label for="inventoryUnitCost">Unit Cost:</label>
                    <input type="number" id="inventoryUnitCost" step="0.01" min="0" required>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('inventoryModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Item</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Bank Balance Modal -->
    <div id="bankBalanceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Update Bank Balance</h3>
                <span class="close" onclick="closeModal('bankBalanceModal')">&times;</span>
            </div>
            <form id="bankBalanceForm">
                <div class="form-group">
                    <label for="newBankBalance">Current Bank Balance:</label>
                    <input type="number" id="newBankBalance" step="0.01" required>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('bankBalanceModal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">Update Balance</button>
                </div>
            </form>
        </div>
    </div>

    <script src="script-api.js"></script>
</body>
</html>
